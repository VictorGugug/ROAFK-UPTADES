<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Actualizaciones Roblox AFK Clicker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="main-container">
        <h1>Última versión de Roblox AFK Clicker</h1>
        <div id="actualizaciones">
            <p class="cargando">Cargando información de la última release...</p>
        </div>
    </div>

    <script>
    const TEST_MODE = false;
    const repo = 'VictorGugug/ROAFK';
    const assetName = 'ROAFK.zip'; // Nombre fijo del asset en cada release
    
    const testData = [
      { tag_name: 'v1.2.3', name: 'Versión 1.2.3', body: 'Notas de prueba.', published_at: '2025-07-15T12:00:00Z' }
    ];

    function formatDate(iso) {
      return new Date(iso).toISOString().slice(0, 10);
    }

    const apiUrl = `https://api.github.com/repos/${repo}/releases`;
    const fetchPromise = TEST_MODE
      ? Promise.resolve(testData)
      : fetch(apiUrl).then(res => {
          if (!res.ok) throw new Error('Error API GitHub');
          return res.json();
        });

    fetchPromise
      .then(data => {
        const container = document.getElementById('actualizaciones');
        if (!Array.isArray(data) || data.length === 0) {
          container.innerHTML = `<div class="sin-version"><span class="icon-alerta">⚠️</span><div class="sin-version-titulo">No hay releases</div><div class="sin-version-texto">Espera la primera release.</div></div>`;
          return;
        }

        // Tomar la primera (más reciente)
        const rel = data[0];
        const version = rel.tag_name.replace(/^v/, '');
        const notes = rel.body || 'Sin notas.';
        const date = formatDate(rel.published_at);
        const url = `https://github.com/${repo}/releases/download/${rel.tag_name}/${assetName}`;

        container.innerHTML = `
          <div class="versiones-horizontales">
            <div class="cuadro">
              <h2>${rel.name || 'Release'} <span class="version-num">${version}</span></h2>
              <p class="fecha"><span class="icon-fecha">📅</span> <b>Fecha:</b> ${date}</p>
              <p class="notas"><span class="icon-notas">📝</span> ${notes}</p>
              <a class="boton-descarga" href="${url}" target="_blank">⬇️ Descargar</a>
            </div>
          </div>
        `;
      })
      .catch(err => {
        document.getElementById('actualizaciones').innerHTML = `<div class="sin-version"><span class="icon-alerta">⚠️</span><div class="sin-version-titulo">Error cargando</div><div class="sin-version-texto">${err.message}</div></div>`;
      });
    </script>
</body>
</html>
