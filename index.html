<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Actualizaciones Roblox AFK Clicker</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="main-container">
    <h1>Versiones de Roblox AFK Clicker</h1>
    <div>
      <label for="release-select">Selecciona la release:</label>
      <select id="release-select" class="version-select">
        <option value="">-- Cargando... --</option>
      </select>
    </div>
    <div id="detalle-release" class="detalle-release">
      <p class="cargando">Selecciona una version para ver detalles.</p>
    </div>
  </div>

  <script>
    const TEST_MODE = false;
    const repo = 'VictorGugug/ROAFK';
    const apiUrl = `https://api.github.com/repos/${repo}/releases`;

    const testData = [
      { tag_name: 'v1.2.3', name: 'Versión 1.2.3', body: 'Notas de prueba.', published_at: '2025-07-15T12:00:00Z', assets: [{ browser_download_url: 'https://github.com/VictorGugug/ROAFK/releases/download/v1.2.3/ROAFK.zip', name: 'ROAFK.zip' }] },
      { tag_name: 'v1.2.2', name: 'Versión 1.2.2', body: 'Notas antiguas.', published_at: '2025-07-01T08:30:00Z', assets: [{ browser_download_url: 'https://github.com/VictorGugug/ROAFK/releases/download/v1.2.2/ROAFK.zip', name: 'ROAFK.zip' }] }
    ];

    function formatDate(iso) {
      return new Date(iso).toISOString().slice(0, 10);
    }

    // Obtener datos
    const fetchPromise = TEST_MODE
      ? Promise.resolve(testData)
      : fetch(apiUrl).then(res => {
          if (!res.ok) throw new Error('Error API GitHub');
          return res.json();
        });

    fetchPromise.then(data => {
      const select = document.getElementById('release-select');
      select.innerHTML = `<option value="">-- Elige una versión --</option>`;
      data.forEach((rel, idx) => {
        const version = rel.tag_name.replace(/^v/, '');
        const label = rel.name || version;
        select.innerHTML += `<option value="${idx}">${label}</option>`;
      });

      select.addEventListener('change', () => mostrarRelease(data[select.value]));
      // por defecto, seleccionar la más reciente
      select.value = 0;
      mostrarRelease(data[0]);
    }).catch(err => {
      document.getElementById('detalle-release').innerHTML = `<div class="sin-version"><span class="icon-alerta">⚠️</span><div class="sin-version-titulo">Error cargando releases</div><div class="sin-version-texto">${err.message}</div></div>`;
    });

    function mostrarRelease(rel) {
      const cont = document.getElementById('detalle-release');
      if (!rel) {
        cont.innerHTML = `<p class="cargando">No hay detalles para esta versión.</p>`;
        return;
      }
      const version = rel.tag_name.replace(/^v/, '');
      const notes = rel.body || 'Sin notas.';
      const date = formatDate(rel.published_at);
      const asset = (rel.assets && rel.assets[0]);
      const url = asset ? asset.browser_download_url : '#';
      const assetName = asset ? asset.name : 'Descargar';

      cont.innerHTML = `
      <div class="versiones-horizontales">
        <div class="cuadro">
          <h2>${rel.name || 'Release'} <span class="version-num">${version}</span></h2>
          <p class="fecha"><span class="icon-fecha">📅</span> <b>Fecha:</b> ${date}</p>
          <p class="notas"><span class="icon-notas">📝</span> ${notes}</p>
          <a class="boton-descarga" href="${url}" target="_blank">⬇️ ${assetName}</a>
        </div>
      </div>
      `;
    }
  </script>
</body>
</html>
