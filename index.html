<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Versiones de Roblox AFK Clicker</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Sidebar vertical */
    .container {
      display: flex;
      max-width: 1000px;
      margin: 2em auto;
      gap: 2em;
    }
    .sidebar {
      flex: 0 0 200px;
      background: #18181b;
      border-radius: 10px;
      padding: 1em;
      box-shadow: 0 2px 16px #000a;
      display: flex;
      flex-direction: column;
      gap: 0.5em;
    }
    .sidebar a {
      color: #a5b4fc;
      text-decoration: none;
      padding: 0.5em;
      border-radius: 6px;
      transition: background 0.2s;
    }
    .sidebar a:hover {
      background: #23232a;
    }
    .sidebar a.active {
      background: #6366f1;
      color: #fff;
    }
    .content {
      flex: 1;
    }
  </style>
</head>
<body>
  <div class="main-container">
    <h1>Versiones de Roblox AFK Clicker</h1>
    <div class="container">
      <nav class="sidebar" id="sidebar">
        <!-- Releases list -->
      </nav>
      <div class="content" id="detalle-release">
        <p class="cargando">Selecciona una versión a la izquierda.</p>
      </div>
    </div>
  </div>
  <script>
    const TEST_MODE = false;
    const repo = 'VictorGugug/ROAFK';
    const apiUrl = `https://api.github.com/repos/${repo}/releases`;

    const testData = [
      { tag_name: 'v1.2.3', name: 'Versión 1.2.3', body: 'Notas de prueba.', html_url: 'https://github.com/VictorGugug/ROAFK/releases/tag/v1.2.3', published_at: '2025-07-15T12:00:00Z', assets: [{ browser_download_url: 'https://github.com/VictorGugug/ROAFK/releases/download/v1.2.3/ROAFK.zip', name: 'ROAFK.zip' }] },
      { tag_name: 'v1.2.2', name: 'Versión 1.2.2', body: 'Notas antiguas.', html_url: 'https://github.com/VictorGugug/ROAFK/releases/tag/v1.2.2', published_at: '2025-07-01T08:30:00Z', assets: [{ browser_download_url: 'https://github.com/VictorGugug/ROAFK/releases/download/v1.2.2/ROAFK.zip', name: 'ROAFK.zip' }] }
    ];

    function formatDate(iso) {
      return new Date(iso).toISOString().slice(0, 10);
    }

    const fetchPromise = TEST_MODE
      ? Promise.resolve(testData)
      : fetch(apiUrl).then(res => {
          if (!res.ok) throw new Error('Error API GitHub');
          return res.json();
        });

    fetchPromise.then(data => {
      const sidebar = document.getElementById('sidebar');
      const content = document.getElementById('detalle-release');
      sidebar.innerHTML = '';

      data.forEach((rel, idx) => {
        const link = document.createElement('a');
        link.href = '#';
        link.textContent = rel.tag_name.replace(/^v/, '');
        link.dataset.index = idx;
        link.addEventListener('click', e => {
          e.preventDefault();
          document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
          link.classList.add('active');
          mostrarRelease(rel);
        });
        sidebar.appendChild(link);
      });

      // Seleccionar release más reciente (en medio visualmente)
      const firstLink = sidebar.querySelector('a');
      if (firstLink) {
        firstLink.classList.add('active');
        mostrarRelease(data[0]);
      }
    }).catch(err => {
      document.getElementById('detalle-release').innerHTML = `<div class="sin-version"><span class="icon-alerta">⚠️</span><div class="sin-version-titulo">Error cargando releases</div><div class="sin-version-texto">${err.message}</div></div>`;
    });

    function mostrarRelease(rel) {
      const version = rel.tag_name.replace(/^v/, '');
      const notes = rel.body || 'Sin notas.';
      const date = formatDate(rel.published_at);
      const asset = (rel.assets && rel.assets[0]);
      const downloadUrl = asset ? asset.browser_download_url : '#';
      const assetName = asset ? asset.name : 'Descargar';
      const releasePage = rel.html_url;

      document.getElementById('detalle-release').innerHTML = `
        <div class="versiones-horizontales">
          <div class="cuadro">
            <h2><a href="${releasePage}" target="_blank">${rel.name || 'Release'}</a> <span class="version-num">${version}</span></h2>
            <p class="fecha"><span class="icon-fecha">📅</span> <b>Fecha:</b> ${date}</p>
            <p class="notas"><span class="icon-notas">📝</span> ${notes}</p>
            <a class="boton-descarga" href="${downloadUrl}" target="_blank">⬇️ ${assetName}</a>
          </div>
        </div>
      `;
    }
  </script>
</body>
</html>
